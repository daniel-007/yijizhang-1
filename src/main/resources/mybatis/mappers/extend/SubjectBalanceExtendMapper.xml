<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.ahyc.yjz.mapper.extend.SubjectBalanceExtendMapper" >
  <resultMap id="ResultMap" type="cn.ahyc.yjz.dto.SubjectBalanceDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 29 15:13:58 CST 2015.
    -->
    <constructor >
      <idArg column="id" jdbcType="BIGINT" javaType="java.lang.Long" />
      <arg column="subject_code" javaType="java.lang.Long" jdbcType="BIGINT" />
      <arg column="initial_debit_balance" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="initial_credit_balance" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="period_debit_occur" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="period_credit_occur" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="year_debit_occur" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="year_credit_occur" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="terminal_debit_balance" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="terminal_credit_balance" jdbcType="DECIMAL" javaType="java.math.BigDecimal" />
      <arg column="book_id" jdbcType="BIGINT" javaType="java.lang.Long" />
      <arg column="period_id" jdbcType="BIGINT" javaType="java.lang.Long" />
      <arg column="direction" jdbcType="INTEGER" javaType="java.lang.Integer" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 29 15:13:58 CST 2015.
    -->
    id, subject_code, initial_debit_balance, initial_credit_balance, period_debit_occur, 
    period_credit_occur, year_debit_occur, year_credit_occur, terminal_debit_balance, 
    terminal_credit_balance, book_id, period_id, direction
  </sql>
  <select id="selectProfitAndLoss" parameterType="java.util.Map" resultMap="ResultMap">
    SELECT a.id, a.subject_code, a.initial_debit_balance, a.initial_credit_balance, a.period_debit_occur, 
	    a.period_credit_occur, a.year_debit_occur, a.year_credit_occur, a.terminal_debit_balance, 
	    a.terminal_credit_balance, a.book_id, a.period_id, t.direction
	FROM
	  account_subject t,
	  subject_balance a 
	WHERE NOT EXISTS 
	  (SELECT 
	    * 
	  FROM
	    account_subject t1,
	    account_subject t2 
	  WHERE t1.subject_code = t2.parent_subject_code 
	    AND t.subject_code = t1.subject_code) 
	  AND t.subject_code = a.subject_code 
	  AND t.book_id = a.book_id 
	  AND a.book_id = #{bookId,jdbcType=BIGINT}
	  AND a.period_id = #{periodId,jdbcType=BIGINT}
	  AND t.subject_code LIKE #{startCode,jdbcType=VARCHAR}"%"
	  AND (a.terminal_credit_balance>0 OR a.terminal_debit_balance>0)
	  ORDER BY a.id
  </select>


  


</mapper>